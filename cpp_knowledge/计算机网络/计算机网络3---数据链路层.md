## 计算机网络3



Vedio: 

[计算机网络微课堂（有字幕无背景音乐版）](https://www.bilibili.com/video/BV1c4411d7jb?vd_source=3fb5d6e30320f23cfaa7814e883f9b2f)

[TOC]



### 3.1数据链路层的功能

**链路**：从一个节点到相邻结点的一段物理线路，而中间没有其它的交换节点。

**数据链路**：指把实现通信协议的硬件和软件加到链路上，就构成了数据链路。

数据链路层以帧为单位传输和处理数据。

**数据链路层和物理层实现在网卡上**，对于路由器和交换机来说，每个端口都有自己独立的数据链路层和物理层。不同网络对应数据链路层和物理层协议不同，实现功能也不同。比如Ethernet中不提供可靠传输服务，无线网络提供一定程度的可靠传输。相应的有多种数据链路层协议，比如PPP，CSMA/CD，CSMA/CA等，但是会在网络层统一，都支持IP协议，具有相同的数据包格式。



##### 使用点对点信道的数据链路层的三个重要问题

- 封装成帧
- 差错检测
- 可靠传输



##### 使用广播信道的数据链路层

- 共享式以太网的媒体接入控制协议CSMA/CD
- 802.11局域网的媒体接入控制协议CSMA/CA



##### 数据链路层的互连设备

- 网桥和交换机的工作原理
- 集线器（物理层互连设备）和交换机的区别



### 3.2封装成帧

- 封装成帧是指数据链路层给上层交付的协议数据单元添加帧头和帧尾使之称为帧
  - 帧头和帧尾中包含有重要的控制信息
  - 帧头和帧尾的作用之一就是定界
- 透明传输是指数据链路层对上层交付的传输数据没有任何限制，就好像数据链路层不存在一样。
  - 面向字节的物理链路使用字节填充的方法进行透明传输
  - 面向比特的物理链路使用比特填充的方法实现透明传输



- 为了提高帧的传输效率，应当使帧的数据部分长度尽可能的大些
- 考虑到差错控制等多种因素，每一种数据链路层协议都规定了帧的数据部分的长度上限，即最大传送单元MTU。



### 3.3差错检测

比特差错，误码率

- 使用差错检测码检测数据在传输时是否产生了比特差错，是数据链路层要解决的重要问题之一。



##### 差错检测技术：

- **奇偶校验**：漏检率高
- **循环冗余校验（Cyclic Redundancy Check)**：检错能力好，漏检率低，但是计算复杂，易于用硬件实现，被广泛应用于数据链路层。
  - 可以用冗余信息更多的纠错码前向纠错，但纠错码开销大。



注：计网中的**检错重传方式**可以纠正传输中的差错，或者仅仅丢弃检测到差错的帧，这取决于数据链路层向其上层提供的是**可靠传输服务还是不可靠传输服务。**



### 3.4可靠传输

#### 基本概念

##### 数据链路层向上层提供的服务类型

- 不可靠传输服务：仅仅丢弃有误码的帧，其它什么也不做
- 可靠传输服务：想办法实现发送端发送什么，接收端就收到什么。

一般情况下，有线链路的误码率比较低，为了减小开销，并不要求数据链路层向上提供可靠传输。



**传输差错**：比特差错，分组丢失，分组失序，分组重复。



#### 实现机制

##### 停止-等待协议（SW，Stop and Wait）

发送误码—>重传

发送丢失—>发送方持续等待接收方回复，措施：增加超时计时器，设置重传时间，称为超时重传。

接收方回复时的数据丢失—>发送方继续发送，产生分组重复，措施：采用一个比特对于发送数据进行编号。

接收方回复慢，发生重复的回复—>对回复进行分组以应对该情况。

![2](E:\Sophomore\计网\image\2.png)



信道利用率：$U=\frac{T_D}{T_D+RTT+T_A}$

当往返时延RTT远远大于数据帧的发送时延$T_D$时，信道利用率很低

若出现重传，对于传送有用的数据信息来说，信道利用率还要降低

为了克服停止等待协议信道利用率低的缺点，就产生了另外两种协议。



##### 回退N帧协议（GBN，Go-Back-N）

接收方不一定要对收到的数据分组逐个发送确认，而是在收到几个数据分组后，对按需到达的最后一个数据分组发送确认。

ACKn能保证前n个数据一定能被接收到



##### 选择重传协议（SR）

**选择重传协议**为了使发送方仅重传出现差错的分组，接收方不能再采用累计确认，而需要对每个正确接收到的数组分组进行逐一确认。

发送窗口：$1<W_T\leq2^{(n-1)}$

接收窗口：$1<W_R\leq W_T$

![3](E:\Sophomore\计网\image\3.png)



### 3.5多址接入协议—link access

链路：相邻两个结点（point-to-point link）或者多个节点（broadcast link）共享的资源，需要链路访问协议确定结点见共享链路的方式。

- 点对点
- 广播：共享链路的结点比较多，MAC负责

###### 特点

1. 广播链路具有独占性。MAC主要用于阻挡多个结点在信道上叠加，发生collision，尽量减少或者避免冲突的发生。
2. 没有带外信道。

###### 设计原则

1. 充分利用链路资源：只有一个结点用到链路时，发送速率能达达到$R$。
2. 公平性
3. 分布式，减少结点间信息交互

#### MAC的分类

##### 信道划分

TDM**时分多路复用**

缺点：

- 最高速率只有R/N bps,即使只有一个人用信道
- 消除碰撞，十分公平
- 结点需要等待时隙，可能对缓存造成压力

FDM**频分多路复用**

- 特点和TDM差不多，不过是限制了带宽

CDMA**码分多址**

CDMA对每个结点分配不同的编码，使得不同结点能同时传输



##### 随机接入

总是以信道全部速率 R bps进行发送

有碰撞时，等待一个随机时延，然后重发

常用随机接入协议

###### 时隙ALOHA

结点有新帧发送时，等待下一个时隙开始传输整个帧

如果有碰撞，结点在时隙结束之前检测这次碰撞，以p的概率在后序的每个时隙重传该帧，直到无碰撞。

###### 纯ALOHA

碰撞时，立即以概率p重传该帧，否则等待一个帧传输时间

效率：仅为时隙ALOHA的一半

###### **载波侦听多路访问**CSMA

 在时隙和纯ALOHA中，单个结点传输独立于其它结点。

但是**载波侦听**中，会先进行等待

**碰撞检测：**传输结点传输时持续监听，如果有另一个结点传输，他就停止，等待随即事件，重复空闲时传输的动作（时延）

这两个规则包含在CSMA和具有碰撞检测的CSMA/CD协议族中

###### CSMA/CD

载波监听，碰撞检测，二进制指数倒退



##### 轮流设计

###### 轮询

指定一个主结点，以循环的方式轮询每个结点

主结点首先向结点A发送一个报文，告知A能传输帧的最大数量，A传完后主节点告诉B能传帧的最多数量，如此循环

缺点：有轮询时间延迟，防止主节点故障

###### 令牌环

一个token的特殊帧在结点之间以固定次序交换，像网络拓扑结构中的环状网络令牌

当一个结点收到令牌，有帧打算最大数量的帧，然后转发令牌；没帧则直接转发

缺点：单点故障

### 3.6了解ALOHA，Slotted ALOHA

随机接入，CSMA/CD协议

### 3.7 交换局域网



#### mac地址（物理地址等）

链路层地址

###### 地址解析协议ARP

DNS：为因特网中任何地方解析主机名

ARP：为子网上的主机和路由器解析IP地址

###### 发送数据报到子网以外

- 路由器有几个接口，就有几个IP地址、ARP模块和适配器，假设一个路由器连着两个子网A、B

- 子网A中的适配器要发往子网B中的适配器，先通过子网A的ARP把数据报发到子网A跟子网B相连的路由器（目的地址是路由器的MAC），路由器通过子网B的ARP将该数据报转发给目的适配器（目的地址是最终目的地的MAC）



### 3.8 理解Ethernet

不可靠，无连接



###### 链路层交换机

接收链路层帧，转发到出链路。

即插即用设备，双工，转发和过滤，自学习

- 消除碰撞
- 异质链路
- 网络管理

### 3.9 理解WLAN

虚拟局域网VLAN

由一些局域网网段构成的与物理位置无关的逻辑组，每一个VLAN都有一个明确的标识符，指明这个帧的计算机属于哪一个VLAN。

##### CSMA/CD回顾

这是一种分解访问冲突的协议，比较适用于非实时传播数据，网络负载很小时，发送速度块，通信效率很高，并且时半双工，不能同时发送和接收。争用期为2t。

##### CSMA/CA

无线网络中很难进行冲突检测，比如两个站之间的距离过大或者中间障碍物的分隔而检测不到冲突，但是位于他们之间的第三个站可能检测到冲突，这就是所谓隐蔽终端的问题。

- 接收信号往往小于发生信号，实现碰撞难度过大
- 隐蔽终端问题。暴露站检测到忙碌信号但是未必影响数据发送，自己的信号会覆盖其它可以发生的信号。

###### 定义IFS，帧间隔

操作过程：

- 如果有一个站有数据要发送并且监听到信号忙，产生一个随机数设置自己的后退计数器继续监听
- 监听到空闲后等待IFS时间，开始计数，最先计数完的站可以开始发送
- 其它站在听到有新的站开始发送后暂停计数，在新的站发送完成后等待IFS时间继续计数，直到计数完成

注：两次IFS之间的间隔是各个站竞争发送的时间，这个算法对于参与竞争的站是公平的，基本是FIFO的原则。

RTS/CTS：帧间隔时间短，有较高优先级。SIFS

### 3.10理解网络软件体系结构(TCP/IP协议栈的工作过程总结)



